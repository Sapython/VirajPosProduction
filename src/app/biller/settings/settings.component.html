<section>
  <div class="close">
    <viraj-button type="icon" (vclick)="dialogRef.close()"><i class="ri-close-line"></i></viraj-button>
  </div>
  <div class="main">
    <div class="tabs">
      <button
        (click)="activeTab = 'about'"
        [ngClass]="{ active: activeTab == 'about' }"
      >
        About
      </button>
      <button
        (click)="activeTab = 'printer'"
        [ngClass]="{ active: activeTab == 'printer' }"
      >
        Printer
      </button>
      <button
        (click)="activeTab = 'view'"
        [ngClass]="{ active: activeTab == 'view' }"
      >
        View
      </button>
      <button
        (click)="activeTab = 'config'"
        [ngClass]="{ active: activeTab == 'config' }"
      >
        Config
      </button>
      <button
        (click)="activeTab = 'account'"
        *ngIf="this.dataProvider.getAccess(['admin'])"
        [ngClass]="{ active: activeTab == 'account' }"
      >
        Account
      </button>
      <button
        (click)="activeTab = 'discount'"
        [ngClass]="{ active: activeTab == 'discount' }"
      >
        Discounts
      </button>
      <button
        (click)="activeTab = 'payment'"
        [ngClass]="{ active: activeTab == 'payment' }"
      >
        Payments
      </button>
      <button
        (click)="activeTab = 'taxes'"
        [ngClass]="{ active: activeTab == 'taxes' }"
      >
        Taxes
      </button>
    </div>
    <div class="active spaced" [ngSwitch]="activeTab">
      <ng-container *ngSwitchCase="'printer'">
        <h3>Printer Settings</h3>
        <mat-form-field appearance="outline" *ngIf="this.dataProvider.currentBusiness">
          <mat-label>Bill Printer</mat-label>
          <mat-select
          #billerPrinter
          [(ngModel)]="this.dataProvider.currentBusiness.billerPrinter"
          (selectionChange)="updateBillPrinter(billerPrinter.value)"
            name="printer"
          >
            <mat-option> Select </mat-option>
            <mat-option [value]="printer" *ngFor="let printer of printers">
              {{ printer }}
            </mat-option>
          </mat-select>
        </mat-form-field>
        <mat-form-field appearance="outline">
          <mat-label>Custom Bill Note</mat-label>
          <input type="text" matInput [(ngModel)]="this.dataProvider.customBillNote" (change)="updateSettings({customBillNote:customBillNote.value})" #customBillNote>
        </mat-form-field>
        <mat-form-field appearance="outline" matTooltip="This text will be added as prefix on printed bill' bill no">
          <mat-label>Bill No Suffix</mat-label>
          <input type="text" matInput [(ngModel)]="this.dataProvider.billNoSuffix" (change)="updateSettings({billNoSuffix:billNoSuffixInput.value})" #billNoSuffixInput>
        </mat-form-field>
        <!-- <mat-slide-toggle
            [(ngModel)]="dataProvider.optionalTax"
            (change)="updateSettings({optionalTax:dataProvider.optionalTax})"
            >Optional Tax</mat-slide-toggle
          > -->
        <mat-slide-toggle matTooltip="Print Bill After Finalize"
            [(ngModel)]="dataProvider.printBillAfterFinalize"
            (change)="updateSettings({printBillAfterFinalize:dataProvider.printBillAfterFinalize})"
            >Bill After Finalize</mat-slide-toggle
          >
        <mat-slide-toggle matTooltip="Print Bill After Settle"
            [(ngModel)]="dataProvider.printBillAfterSettle"
            (change)="updateSettings({printBillAfterSettle:dataProvider.printBillAfterSettle})"
            >Bill After Settlement</mat-slide-toggle
          >
      </ng-container>
      <ng-container *ngSwitchCase="'account'">
        <h3>Account Settings</h3>
        <button mat-flat-button color="primary" (click)="addAccount()">
          Add Account
        </button>
        <!-- <ol>
          <li *ngFor="let account of accounts">
            <strong></strong>
          </li>
        </ol> -->
        <table class="uk-table uk-table uk-table-divider">
          <thead>
            <tr>
              <th>Username</th>
              <th>Role</th>
              <th>Update By</th>
              <th>Created On</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let account of this.dataProvider.currentBusiness?.users; let i = index">
              <td>
                <ng-container *ngIf="!account.new">
                  {{ account.username }}
                </ng-container>
                <input
                  type="text"
                  [(ngModel)]="account.username"
                  *ngIf="account.new"
                />
              </td>
              <td class="select">
                <mat-select
                  placeholder="Select"
                  (valueChange)="updateBusiness()"
                  [(ngModel)]="account.access"
                  name="access"
                >
                  <mat-option
                    *ngFor="let access of this.dataProvider.accessLevels"
                    [value]="access"
                  >
                    {{ access | titlecase }}
                  </mat-option>
                </mat-select>
              </td>
              <td>{{ account.updatedBy }}</td>
              <td>
                {{ account.lastUpdated.toDate() | date : "short" }}
                <button
                  mat-flat-button
                  *ngIf="account.new"
                  color="primary"
                  (click)="updateBusiness()"
                >
                  Update
                </button>
                <button mat-icon-button (click)="deleteAccount(i)">
                  <mat-icon>delete</mat-icon>
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </ng-container>
      <ng-container *ngSwitchCase="'view'">
        <h3>View Modes</h3>
        <div class="row smartButtons">
          <button
            [disabled]="true"
            [ngClass]="{ selected: dataProvider.smartMode }"
            (click)="smartModeToggle(true)"
          >
            <img src="assets/images/brain.svg" alt="" />
            Smart Mode*
          </button>
          <button
            [ngClass]="{ selected: !dataProvider.smartMode }"
            (click)="smartModeToggle(false)"
          >
            <img src="assets/images/noBrain.svg" alt="" />
            Simple Mode
          </button>
        </div>
        <div class="row smartButtons">
          <button
            [ngClass]="{ selected: !dataProvider.touchMode }"
            (click)="touchModeToggle(false)"
          >
            <img src="assets/images/click.svg" alt="" />
            Click Mode
          </button>
          <button
            [ngClass]="{ selected: dataProvider.touchMode }"
            (click)="touchModeToggle(true)"
          >
            <img src="assets/images/touch.svg" alt="" />
            Touch Mode
          </button>
        </div>
        <div>
          <mat-slide-toggle matTooltip="Show table view after kot, bill, nc, settle and discount."
            [(ngModel)]="dataProvider.showTableOnBillAction"
            (change)="setLocalShowTable($event)"
            >Show table on bill action</mat-slide-toggle
          >
        </div>
        <div>
          <mat-form-field appearance="outline" matTooltip="Total time to mark a table as late in minutes">
            <mat-label>Table timeout</mat-label>
            <input type="text" matInput [(ngModel)]="this.dataProvider.tableTimeOutTime" (change)="updateSettings({tableTimeOutTime:time.value})" #time>
          </mat-form-field>
        </div>
        <p class="danger">
          <sup>*</sup> Smart mode is currently disabled for this account.
        </p>
      </ng-container>
      <ng-container *ngSwitchCase="'about'">
        <h3>About</h3>
        <table [cellSpacing]="0">
          <tr>
            <td>Name</td>
            <td>Viraj</td>
          </tr>
          <tr>
            <td>Version</td>
            <td>
              {{ version }}
            </td>
          </tr>
          <tr>
            <td>Server Version</td>
            <td>
              {{ version }}
            </td>
          </tr>
          <tr>
            <td>Account</td>
            <td>
              {{ account }}
            </td>
          </tr>
        </table>
      </ng-container>
      <ng-container *ngSwitchCase="'config'">
        <h3>Active Modes</h3>
        <div class="modes">
          <mat-slide-toggle
            [(ngModel)]="modes[0]"
            (change)="updateMode()"
            [disabled]="twoModeDeactived && modes[0]"
            >Dine In</mat-slide-toggle
          >
          <mat-slide-toggle
            [(ngModel)]="modes[1]"
            (change)="updateMode()"
            [disabled]="twoModeDeactived && modes[1]"
            >Takeaway</mat-slide-toggle
          >
          <mat-slide-toggle
            [(ngModel)]="modes[2]"
            (change)="updateMode()"
            [disabled]="twoModeDeactived && modes[2]"
            >Online</mat-slide-toggle
          >
        </div>
        <hr />
        <h3>More Config</h3>
        <form class="form" [formGroup]="settingsForm" (ngSubmit)="saveSettings()">
          <mat-form-field class="example-form-field" appearance="outline">
            <mat-label>Project Name:</mat-label>
            <input matInput type="text" formControlName="hotelName" />
          </mat-form-field>
          <mat-form-field class="example-form-field" appearance="outline">
            <mat-label>Phone Number:</mat-label>
            <input matInput type="text" formControlName="phone" />
          </mat-form-field>
          <mat-form-field
            class="example-form-field fullWidth"
            appearance="outline"
          >
            <mat-label>Address:</mat-label>
            <input matInput type="text" formControlName="address" />
          </mat-form-field>
          <!-- <mat-form-field class="example-form-field" appearance="outline">
            <mat-label>Port:</mat-label>
            <input matInput type="text" formControlName="port" />
          </mat-form-field> -->
          <mat-form-field class="example-form-field" appearance="outline">
            <mat-label>GST No:</mat-label>
            <input matInput type="text" formControlName="gst" />
          </mat-form-field>
          <mat-form-field class="example-form-field" appearance="outline">
            <mat-label>FSSAI No:</mat-label>
            <input matInput type="text" formControlName="fssai" />
          </mat-form-field>
          <!-- <mat-form-field appearance="outline">
            <mat-label>Choose Printer For Bill</mat-label>
            <mat-select formControlName="billPrinter">
              <mat-option>Clear</mat-option>
              <mat-option [value]="printer" *ngFor="let printer of printers">{{
                printer
              }}</mat-option>
            </mat-select>
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>Choose Printer For KOT</mat-label>
            <mat-select formControlName="kotPrinter">
              <mat-option>Clear</mat-option>
              <mat-option [value]="printer" *ngFor="let printer of printers">{{
                printer
              }}</mat-option>
            </mat-select>
          </mat-form-field> -->
          <!-- <mat-form-field class="example-form-field" appearance="outline">
            <mat-label>Counter No:</mat-label>
            <input matInput type="text" formControlName="counterNo" />
          </mat-form-field>
          <mat-form-field class="example-form-field" appearance="outline">
            <mat-label>Cashier Name:</mat-label>
            <input matInput type="text" formControlName="cashierName" />
          </mat-form-field>
          <mat-form-field class="example-form-field" appearance="outline">
            <mat-label>Device Name:</mat-label>
            <input matInput type="text" formControlName="deviceName" />
          </mat-form-field> -->
          <!-- <button
            color="primary"
            style="margin-right: 20px"
            (click)="cancelSettings()"
            mat-stroked-button
            type="button"
          >
            Cancel
          </button> -->
          <button
            color="primary"
            style="margin-right: 20px"
            mat-flat-button
            type="submit"
          >
            Submit
          </button>
        </form>
      </ng-container>
      <ng-container *ngSwitchCase="'discount'">
        <h3>Discount</h3>
        <div class="discount">
          <button color="primary" mat-raised-button (click)="addDiscount()">
            Add Discount
          </button>
          <div class="tableContainer">
            <table>
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Value</th>
                  <th>Type</th>
                  <th>Min Amount</th>
                  <th>Min Products</th>
                  <th>Max Discount</th>
                  <th>Created On</th>
                  <th>Menus</th>
                  <th>Access</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let discount of discounts">
                  <td>{{ discount.name }}</td>
                  <td>{{ discount.value }}</td>
                  <td>{{ discount.type }}</td>
                  <td>{{ discount.minimumAmount }}</td>
                  <td>{{ discount.minimumProducts }}</td>
                  <td>{{ discount.maximumDiscount }}</td>
                  <td>
                    {{
                      discount.creationDate
                        ? (discount.creationDate.toDate() | date)
                        : "N/A"
                    }}
                  </td>
                  <td>
                    <li *ngFor="let item of getMappedMenu(discount.menus)">
                      {{ item.name }}
                    </li>
                  </td>
                  <td>
                    <li *ngFor="let item of discount.accessLevels">
                      {{ item }}
                    </li>
                  </td>
                  <td>
                    <viraj-button (vclick)="editDiscount(discount)" type="icon"><i class="ri-pencil-fill"></i></viraj-button>
                    <viraj-button (vclick)="deleteDiscount(discount.id)" type="icon"><i class="ri-delete-bin-2-fill"></i></viraj-button>
                  </td>
                </tr>
                <tr *ngIf="loadingDiscount">
                  <td colspan="8">
                    <mat-spinner mode="indeterminate"> </mat-spinner>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </ng-container>
      <ng-container *ngSwitchCase="'payment'">
        <h3>Payment Methods</h3>
        <button color="primary" mat-raised-button (click)="addMethod()">
          Add Method
        </button>
        <table class="tableContainer">
          <thead>
            <tr>
              <th>Method Name</th>
              <th>Detail</th>
              <th>Add Date</th>
              <th>Update Date</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let item of paymentMethods">
              <td>{{item.name}}</td>
              <td>{{item.detail ? 'Required' : 'Not Required'}}</td>
              <td>{{item.addDate.toDate() | date:'short'}}</td>
              <td>{{item.updateDate.toDate() | date:'short'}}</td>
              <td>
                <viraj-button (vclick)="editMethod(item)" type="icon"><i class="ri-pencil-line"></i></viraj-button>
                <viraj-button (vclick)="deleteMethod(item.id)" type="icon"><i class="ri-delete-bin-line"></i></viraj-button>
              </td>
            </tr>
          </tbody>
        </table>
      </ng-container>
      <ng-container *ngSwitchCase="'taxes'">
        <h3>Taxes</h3>
        <button color="primary" mat-raised-button (click)="addTax()">
          Add Tax
        </button>
        <table>
          <thead>
            <tr>
              <th>Tax Name</th>
              <th>Tax Cost</th>
              <th>Type</th>
              <th>Add Date</th>
              <th>Update Date</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let tax of taxes">
              <td>{{tax.name}}</td>
              <td>{{tax.cost}}</td>
              <td>{{tax.type | titlecase}}</td>
              <td>{{tax.mode | titlecase}}</td>
              <td>{{tax.creationDate.toDate() | date}}</td>
              <td>{{tax.updateDate.toDate() | date}}</td>
              <td>
                <viraj-button (vclick)="editTax(tax)" type="icon"><i class="ri-pencil-line"></i></viraj-button>
                <viraj-button (vclick)="deleteTax(tax.id)" type="icon"><i class="ri-delete-bin-line"></i></viraj-button>
              </td>
            </tr>
          </tbody>
        </table>
      </ng-container>
    </div>
  </div>
</section>
